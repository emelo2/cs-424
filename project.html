<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <style>
  </style>
</head>

<body>
  <script>
    
    
d3.csv('stream.csv', function(err, d){
  if(err) console.log(err);
  //console.log(d)
  
  var nested_data = d3.nest()
		.key(function(d) { 
            //console.log(d.date)
            return d.date; 
        })
		.entries(d);
  
  //console.log(nested_data);
  
  var mqpdata = nested_data.map(function(d){
    var obj = {
      month: new Date(d.key, 1, 3)
    }
    d.values.forEach(function(v){
      obj[v.key] = +v.value;
    //  console.log(obj[v.key]);
    })
    
    return obj;
  })
  
  buildStreamGraph(mqpdata);
  
})


function buildStreamGraph(mqpdata) {
var data = mqpdata;
  
//console.log(data);
var stack = d3.stack()
    .keys(["0","1","2","3","4","5","6","7","8","9"])
    .order(d3.stackOrderNone)
    .offset(d3.stackOffsetWiggle);

var series = stack(data);

var width = 900,
    height = 800;
var margin = {top:10, bottom:60, left:20, right:40}, 
    width = width - margin.right - margin.left,
    height = height - margin.top - margin.bottom;
var padding = 20;
    
var x = d3.scaleTime()
    .domain(d3.extent(data, function(d){ 
       console.log(d.month);
        return d.month; 
    }))
    .range([0, 500]);

var y = d3.scaleLinear()
    .domain([0, d3.max(series, function(layer) { 
        return d3.max(layer, function(d){ return d[0] + d[1];}); })])
    .range([height/2, -200]);

var color = d3.scaleLinear()
    .range(["#b96a4f", "#54b9a5"]);

var colorrange = ["#00090f", "#001623", "#01263b","#034971", "#045A8D", "#2B8CBE", "#74A9CF", "#A6BDDB", "#D0D1E6", "#F1EEF6"];
    
var z = d3.scaleOrdinal()
    .range(colorrange);
    
var area = d3.area()
    .x(function(d) { 
        console.info('in area function', d); 
        //console.log(d.data.month)s
        return x(d.data.month); 
    })
    .y0(function(d) { return y(d[0]); })
    .y1(function(d) { return y(d[1]); })
    .curve(d3.curveBasis);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
    .append("g")
        .attr("transform", "translate(" + margin.left*2 + "," + margin.top +")");

svg.selectAll("path")
    .data(series)
    .enter().append("path").attr("transform", function (d, i){
        return "translate(0," + -i * 4 + ")";
      })
    .attr("d", area)
    .style("fill", function(d, i) { return z(i); })
    .on('mouseover', function(d){
      d3.select(this).style('fill',d3.rgb( d3.select(this).style("fill") ).brighter());
      d3.select("#major").text(d.key);
      console.log(d.key)
    })
    .on('mouseout', function(d){      
      d3.select(this).style('fill', 
         d3.rgb( d3.select(this).style("fill") ).darker());
         d3.select("#major").text("Mouse over");
})

    console.log(height)
  // Add the X Axis
  svg.append("g")
      .attr("transform", "translate(0," + 500 + ")")
      .call(d3.axisBottom(x));
}
  </script>
</body>